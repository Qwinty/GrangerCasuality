# План проекта: Анализ причинно-следственных связей по Грейнджеру

## 1. Предобработка данных

### Источники данных

- `Moscow_Temp.txt` - температурные показатели
- Выбор второго датасета:
  - `moscow_dtp_transformed.csv` (ДТП)
  - `moscow_mortality.csv` (Смертность)

### Этапы обработки

1. Унификация временных меток:
   - Приведение к формату `YYYY-MM`
   - Проверка полноты временного ряда
2. Нормализация данных:
   - Z-score стандартизация для температур
   - Логарифмирование счетных показателей (ДТП/смертность)
3. Агрегация показателей:
   - Среднемесячная температура
   - Суммарные показатели ДТП/смертности за месяц

## 2. Проверка стационарности

**Методы:**

- Тест Дики-Фуллера (ADF)
- Kwiatkowski-Phillips-Schmidt-Shin (KPSS) тест
- Визуальный анализ автокорреляционных функций

**Стратегия преобразований:**

1. Дифференцирование ряда (1-2 порядка)
2. Сезонная декомпозиция (STL)
3. Комбинированные преобразования (логарифм+дифференцирование)

## 3. Определение оптимального лага

**Критерии выбора:**

- Информационный критерий Акаике (AIC)
- Информационный критерий Шварца (BIC)
- Анализ остатков VAR модели

**Процедура:**

1. Построение VAR моделей с лагами 1-12
2. Сравнение критериев информативности
3. Проверка стабильности модели (обратные корни)

## 4. Тест Грейнджера

**Реализация:**

- Многовариантный тест для систем временных рядов
- Оценка направленности влияния:
  - Температура → ДТП/Смертность
  - ДТП/Смертность → Температура

**Интерпретация:**

- Анализ F-статистик и p-values
- Оценка величины влияния через коэффициенты VAR

## 5. Визуализация

**Основные графики:**

1. Совмещенные временные ряды
2. Кросс-коррелограммы
3. Импульсные переходные функции
4. Декомпозиция дисперсии ошибок прогноза

**Технологии:**

- Matplotlib/Seaborn для статических графиков
- Plotly для интерактивной визуализации

## 6. Валидация

**Методы:**

1. Бутстрэппинг:
   - 1000 итераций повторной выборки
   - Построение доверительных интервалов
2. Временная кросс-валидация:
   - Скользящее окно 24 месяца
   - Рекурсивный прогноз на 1-3 шага

## Структура кода

```filestructure
/src
│   main.py - Основной скрипт запуска
│   config.py - Настройки параметров
├── data_processing
│   │   loader.py - Загрузка данных
│   │   cleaner.py - Очистка и трансформация
│   │   merger.py - Объединение временных рядов
├── analysis
│   │   stationarity.py - Проверка стационарности
│   │   var_model.py - Построение VAR моделей
│   │   granger.py - Тестирование причинности
├── visualization
│   │   time_series.py - Визуализация рядов
│   │   diagnostics.py - Графики диагностики
└── utils
    │   logger.py - Логирование
    │   helpers.py - Вспомогательные функции
```

## Требования к коду

1. Обработка исключений:
   - Проверка целостности данных
   - Валидация форматов временных меток
   - Обработка расхождений в периодах наблюдений
2. Оптимизация:
   - Векторизованные вычисления с NumPy
   - Кэширование промежуточных результатов
3. Документация:
   - Type hints для всех функций
   - Docstrings в формате Google Style
   - Примеры использования в Jupyter Notebook

## Запуск тестов

```cmd
python -m unittest discover tests
```
